_modaltpl='<div class="modal fade" id="automodal_<%=idindex%>" tabindex="-1" role="dialog" aria-hidden="true">    <div class="modal-dialog  modal-sm modal-dialog-centered" role="document">        <div class="modal-content gradient-green  z4">            <div class="modal-header">                <h5 class="modal-title" id="exampleModalLabel"><%=title%></h5>                <button type="button" class="close" data-dismiss="modal" aria-label="Close">                    <span aria-hidden="true">×</span>                </button>            </div>            <form method="<%=method%>" <% if(action.length>0){ %> action="<%=action%>" <% } %> >            <input type="hidden" name="op" value="<%=op%>">            <div class="modal-body"><%=body%><%=bodyext%></div>            <div class="modal-footer">                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>                <button type="submit" class="btn btn-primary">提交</button>            </div>            </form>        </div>    </div></div>';function tpl2html(a,b){code='var p=[];with(this){p.push(\''+a.replace(/[\r\t\n]/g,' ').split('<%').join('\t').replace(/((^|%>)[^\t]*)'/g,'$1\r').replace(/\t=(.*?)%>/g,'\',$1,\'').split('\t').join('\');').split('%>').join('p.push(\'').split('\r').join('\\\'')+'\');}return p.join(\'\');';return new Function(code).apply(b)}function text2html(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n?|\n/g,"<br>")}function loadScript(b,c,d){var e=document.getElementsByTagName('script');for(var f=0;f<e.length;f++){var g=e[f];if(g.innerHTML.trim()!='')continue;var h=g.getAttribute('key4unique');var i=g.getAttribute('src');if((typeof(d)=='string'&&typeof(h)=='string'&&h==d)||(typeof(i)=='string'&&i==b)){c();return}}var j=document.createElement("script");j.type="text/javascript";if(j.attachEvent&&!(j.attachEvent.toString&&j.attachEvent.toString().indexOf('[native code')<0)){j.attachEvent('onreadystatechange',function(a){if(a.type==='load'||(readyRegExp.test((a.currentTarget||a.srcElement).readyState))){c(a)}})}else{j.addEventListener('load',function(a){if(a.type==='load'||(readyRegExp.test((a.currentTarget||a.srcElement).readyState))){c(a)}},false)}if(typeof(d)!='undefined')j.setAttribute('key4unique',d);j.src=b;document.getElementsByTagName("head")[0].appendChild(j)}var ktmfautoindex=1;function modal(a){a['idindex']=ktmfautoindex++;_html=tpl2html(_modaltpl,a);$(_html).modal()}function modal_promot(a,b){_dft='';_placeholder='';if(typeof(b.default)!='undefined')_dft=b.default;if(typeof(b.placeholder)!='undefined')_placeholder=b.placeholder;b['body']='<input type="text" class="form-control" name="'+a+'" value="'+_dft+'" placeholder="'+_placeholder+'" >';b=$.extend({title:'请输入',method:'post',placeholder:'',default:'',action:'',op:'',body:'',bodyext:''},b);modal(b)}function modal_select(c,d,e){_html='<select class="form-control" name="'+c+'" >';$.each(d,function(a,b){if(typeof(b.value)!='undefined')_value=b.value;else if(typeof(b.id)!='undefined')_value=b.id;else _value=a;_html+='<option value="'+_value+'">'+b.name+'</option>'});_html+='</select>';e['body']=_html;e=$.extend({title:'请选择',method:'post',action:'',op:'',body:'',bodyext:'',},e);modal(e)}function modal_form(a,b){}function weuitimepicker(b){var c=b;var d=[];var e=0;for(e=0;e<24;e++)d.push({label:e+'时',value:e});var f=[];for(e=0;e<60;e++)f.push({label:e+'分',value:e});var g=[];for(e=0;e<60;e++)g.push({label:e+'秒',value:e});weui.picker(d,f,g,{defaultValue:[7,40,0],onChange:function(a){console.log(a)},onConfirm:function(a){$(c).val(zeroPad(a[0])+':'+zeroPad(a[1])+':'+zeroPad(a[2])).trigger('change')},id:'timePicker',title:'选择时间'})}function weuitimepicker_nos(c,d,e,f){var g=c;var h=[];var i=0;for(i=0;i<24;i++)h.push({label:zeroPad(i)+'时',value:i});var j=[];for(i=0;i<60;i++)j.push({label:zeroPad(i)+'分',value:i});if(typeof e==='string'&&e){var k=e.split(':');e=k.map(function(a){return parseInt(a)})}else if(!e){e=[7,40]}weui.picker(h,j,{defaultValue:e,onConfirm:function(a){var b=zeroPad(a[0])+':'+zeroPad(a[1]);$(g).val(b).trigger('change');if(d){d(a,b)}},id:f||'timeNosPicker',title:'选择时间'})}function weuidatetimepicker(g){var i=g;var j='';var k=$(g).attr('format')||'Y-m-d H:i:s';var l=k!=='Y-m-d';var n=k==='Y-m-d H:i:s';var o=false;if(['rd[fn_907]','rd[fn_2379]'].includes($(g).attr('name'))){n=false;o=true}var p=new Date();var h=p.getHours();var m=p.getMinutes();var s=p.getSeconds();var q=$(g).hasClass('vue');weui.datePicker({onConfirm:function onConfirm(a){j=a[0]+'-'+zeroPad(a[1])+'-'+zeroPad(a[2])+' '},onClose:function onClose(){if(j=='')return;if(!l){$(i).val(j).trigger('change');if(q){i.dispatchEvent(new CustomEvent('input'))}return}var b=[];var c=0;for(c=0;c<24;c++)b.push({label:c+'时',value:c});var d=[];for(c=0;c<60;c++)d.push({label:c+'分',value:c});var e=[b,d];if(n){var f=[];for(c=0;c<60;c++)f.push({label:c+'秒',value:c});e.push(f)}e.push({defaultValue:[h,o?0:m,0],onChange:function(a){},onConfirm:function(a){var s=j+zeroPad(a[0])+':'+zeroPad(a[1]);if(n){s+=':'+zeroPad(a[2])}$(i).val(s).trigger('change');if(q){i.dispatchEvent(new CustomEvent('input'))}},id:'timePicker',title:'选择时间（'+j+'）'});weui.picker.apply(weui.picker,e)},id:'datePicker',title:'选择日期'})}function zeroPad(a){if(a<10)return"0"+""+a;else return a}function calendarDraw(a,b){date=new Date(a,b,0);var c=new Date(date.getFullYear(),date.getMonth()+1,0).getDate();var d=new Date(date.getFullYear(),date.getMonth(),0).getDate();var e=new Date(date.getFullYear(),date.getMonth()+2,0).getDate();date.setDate(1);var f=date.getDay();if(f==0){f=7}date=new Date(a,b,0);var g="<table class='calendarDrawTable'><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th>";_index=0;for(var i=1;i<=f%7;i++){if(_index%7==0)g+="</tr><tr>";_index++;g+="<td></td>"}for(var j=1;j<=c;j++){if(_index%7==0)g+="</tr><tr>";_index++;_dta=new Array();_dta.push(a);_dta.push(zeroPad(b));_dta.push(zeroPad(j));g+='<td dt="'+_dta.join('')+'">'+j+'</td>'}g+="</tr></table>";var h=date.getMonth()+1;var k=date.getFullYear();if(h==1){PrevYear=k-1;PrevMonth=12}else{PrevYear=k;PrevMonth=h-1}if(h==12){NextYear=k+1;NextMonth=1}else{NextYear=k;NextMonth=h+1}return{html:g,cur:{year:a,month:b},prev:{year:PrevYear,month:PrevMonth},next:{year:NextYear,month:NextMonth}}}$(function(){$('textarea.form-control,textarea.layui-textarea').each(function(){$(this).css('height',Math.max(this.scrollHeight,66)+'px');$(this).css('overflow-y','hidden')}).on('input',function(){$(this).css('height','auto');$(this).height(Math.max(this.scrollHeight,33))})});function bjmf_studentinfo(b,c){$.get('/teacher/data/course/'+b+'/student/'+c,function(a){_info='姓名:'+a.name+"\n";_info+='学号:'+a.no+"\n";_info+='性别:'+a.sex+"\n";_info+='班级:'+a.groupname+"\n";if(typeof a.roomname!='undefined')_info+='宿舍:'+a.roomname+"\n";alert(_info)},'json')}function html_upload_js(c,d,e,f){if($('#bjmfuploader_'+c).length>0){$('#'+c).next('div.jFiler').remove()}$('#'+c).after('<input type="file" name="files[]" id="bjmfuploader_'+c+'" multiple autocomplete="off">');if(typeof(kkbupfileschged)!="function"){var g=window.sitecdn===undefined?'//c.d8n.cn':window.sitecdn;$('<link rel="stylesheet" type="text/css" href="'+g+'/res/upload/css/jquery.filer.css?2">').appendTo('body');$('<script src="/res/upload/js/jquery.filer.min.js?2" type="text/javascript"></'+'script>').appendTo('body');window.kkbupfileschged=function(a,b){$("#"+b).val(JSON.stringify(a))}}var h=[];var i=$("#"+c+"").val();if(i&&i.length>5){var j=JSON.parse($("#"+c+"").val());$.each(j,function(a,b){if(typeof(b['file'])!='undefined'&&typeof(b['name'])!='undefined'&&typeof(b['type'])!='undefined'&&typeof(b['size'])!='undefined'){h.push(b)}})}filer_default_opts.ossRole=d;filer_default_opts.ossPath=e||'';$("#bjmfuploader_"+c+"").filer($.extend({changeInput:filer_default_opts.changeInput2,showThumbs:true,theme:"dragdropbox",templates:filer_default_opts.templates,dragDrop:filer_default_opts.dragDrop,uploadFile:filer_default_opts.uploadFile,onRemove:filer_default_opts.onRemove,onRemoved:filer_default_opts.onRemoved,files:h},f))}function get_current_role(){var a=location.pathname;var b='student';if(a.startsWith('/teacher')){b='teacher'}else if(a.startsWith('/org')){b='org'}return b}function html_upload_js_auto(a,b,c){c=c||location.pathname;var d=get_current_role();html_upload_js(a||'attachment',d,c,b)}function upload_file_directly(h,i,j){if(typeof(kkbupfileschged)!="function"){$('<script src="/res/upload/js/jquery.filer.min.js?3" type="text/javascript"></'+'script>').appendTo('body')}filer_default_opts.ossRole=get_current_role();filer_default_opts.ossPath=location.pathname;var k={uploadFile:'/uploadfile'};var l=new FormData();filer_default_opts.prepareKey(k,l,i,function(b){var c=location.hostname;var d=c.startsWith('localhost')||c.endsWith('.local')||c.endsWith('.hans')||!b||!b.host;var e=d?'files[]':'file';var f=d?'/uploadfile':b.host;l.append(e,h);var g=new XMLHttpRequest();g.open("POST",f,true);g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.onreadystatechange=function(){if(g.readyState===4&&g.status===200){var a=JSON.parse(g.responseText);if(a&&a.code===401&&a.msg){alert(a.msg)}else if(a&&a.success){j([a.data])}else if(a&&a.length){j(a)}else{alert('上传失败！')}}};g.send(l)})}var bjmf_voice={localId:'',serverId:''};var bjmf_luyin_ing=false;function bjmf_wx_luyin_2texted(a){if(typeof(bjmf_wx_luyin_2texted_cb)!='undefined')bjmf_wx_luyin_2texted_cb(a.translateResult)}function bjmf_wx_luyin_started(a){bjmf_luyin_ing=true;$("#bjmf_luyin_area").html('<button type="button" onclick="bjmf_wx_luyin_stop()">录音中...点击停止</button>');if(typeof(bjmf_wx_luyin_started_cb)!='undefined')bjmf_wx_luyin_started_cb(a)}function bjmf_wx_luyin_stoped(a){bjmf_luyin_ing=false;bjmf_voice.localId=a.localId;bjmf_wx_luyin_2text();$("#bjmf_luyin_area").html('<button type="button" onclick="bjmf_wx_luyin_start()">开始录音</button>');if(typeof(bjmf_wx_luyin_stoped_cb)!='undefined')bjmf_wx_luyin_stoped_cb(a)}function bjmf_wx_luyin_start(){wx.startRecord({success:function(a){bjmf_luyin_ing=true;bjmf_wx_luyin_started(a)},cancel:function(){bjmf_luyin_ing=false;alert('已拒绝录音')}})}function bjmf_wx_luyin_stop(){wx.stopRecord({success:function(a){bjmf_voice.localId=a.localId;bjmf_wx_luyin_stoped(a)},fail:function(a){alert(JSON.stringify(a))}})}function bjmf_wx_luyin_2text(){wx.translateVoice({localId:bjmf_voice.localId,complete:function(a){if(a.hasOwnProperty('translateResult')){bjmf_wx_luyin_2texted(a)}else{alert('无法识别')}}})}var wx_photo_serverids=[];function wx_camera_photo(d){wx_photo_serverids=[];wx.chooseImage({count:1,sizeType:['compressed'],sourceType:['camera'],success:function(b){var c=b.localIds;for(i=0;i<c.length;i++){wx.uploadImage({localId:c[i],isShowProgressTips:1,success:function(a){wx_photo_serverids.push(a.serverId);if(typeof(d)!="undefined")d(this.localId,a.serverId)},fail:function(a){alert('微信图片上传失败，请重试。'.JSON.stringify(a))}})}}})}function getGroupLabel(a){var b=a.find('.control-label').text()||'';return b.replace(/[*：:]+$/g,'')}function checkUnfinishedField(a){var b=$(a).find('.form-group:visible');var c=null;for(var i=0;i<b.length;i++){var d=b.eq(i);if(d.find('.required-mark').length<=0){continue}var e=d.data('type');if(['radio','checkbox'].indexOf(e)>=0){if(d.find('input:checked').length<=0){c=getGroupLabel(d);break}}else{var f=d.find('input, textarea, select').filter('[name]').val();if(!f||$.trim(f)===''||(e==='file'&&$.trim(f)==='[]')){c=getGroupLabel(d);break}}}if(c){weui.alert("请完成必填项："+c,{title:'提示'});return true}return false}function _autoLinkTextNodesReplace(a,b,c){var d,i;var e=[];var f=[];var g=0;while((d=a.exec(b))!==null){i=d.index;if(d[1]&&d[0][0]!==d[1][0]){i++}e.push(b.slice(g,i));e.push(d[1]||d[0]);f.push(i);g=d.index+d[0].length;if(d[1]&&d[0][d[0].length-1]!==d[1][d[1].length-1]){g--}}if(f.length){e.push(b.slice(g));for(i=0;i<e.length;i++){if(i%2){e[i]=c(e[i])}}return e}return[b]}function _autoLinkTextNodes(g,h){try{document.querySelectorAll('span, p, td, label, div').forEach(function(f){f.childNodes.forEach(function(a){if(a.nodeType===Node.TEXT_NODE){var b=a.textContent;var c=_autoLinkTextNodesReplace(g,b,h);if(c.length>1){var d=[];for(var i=0;i<c.length;i++){var e;if(i%2){e=document.createElement('span');e.innerHTML=c[i]}else{e=document.createTextNode(c[i])}d.push(e)}a.replaceWith.apply(a,d)}}})})}catch(e){console.log(e)}}function autoLinkTextNodes(){_autoLinkTextNodes(/(?:^|[^a-zA-Z0-9])(1[3-9][0-9]{9})(?:[^a-zA-Z0-9]|$)/g,function(p){return'<a href="tel:'+p+'" class="link">'+p+'</a>'});_autoLinkTextNodes(/https?:\/\/[-A-Za-z0-9+&@#\/%?=~_|!:,.;]+[-A-Za-z0-9+&@#\/%=~_|]/g,function(p){return'<a href="'+p+'" class="link" target="_blank">'+p+'</a>'})}function addRedDots(){$('[dote]').each(function(){var a=$(this);var b=a.attr('dote');if(b){if(!localStorage.getItem(b)){a.addClass('rt-dot')}if(a.hasClass('rt-dot-t')){a.on('click',function(){localStorage.setItem(b,'true')})}}})}function getFavoriteLinks(){try{var a=localStorage.getItem('exam_favorite_links')||'{}';a=JSON.parse(a)||{}}catch(e){console.log(e);a={}}return a}function countFavoriteLink(a){try{var b=getFavoriteLinks();var c=b[a.href]||0;b[a.href]=c+1;localStorage.setItem('exam_favorite_links',JSON.stringify(b))}catch(e){console.log(e)}}$(function(){$('.menu-list2 .cell > a').on('click',function(){countFavoriteLink(this)})});function renderFavoriteLinks(){try{var c=[];var d=getFavoriteLinks();$.each(d,function(a,b){if(b>=10){c.push({href:a,count:b})}});if(c.length<=0){return}c.sort(function(a,b){return b.count-a.count});var f=$('.favorite-list .row');var g={};$('.card-body.menu-list .col-3 > a').each(function(){g[this.href]=$(this).parent()});var h=0;$.each(c,function(i,a){if(h>=4){return false}if(!g[a.href]){return}g[a.href].clone().appendTo(f);h++});if(h){$('.favorite-list').show()}}catch(e){console.log(e)}}function timeStr(s){if(!s||!s.endsWith){return s}var a=s.split(':');if(a.length<=2){return s}if(s.endsWith(':00')){return s.substring(0,s.length-3)}return s}function table_col_toggle(c,d,e){if(!Array.isArray(d)){d=[d]}$.each(d,function(a,b){$(c+' tr').find('td:eq('+b+'),th:eq('+b+')').toggle(e)})}function table2xls(a,b,c){var d=null;var e='sheet1';if(typeof b=='string'){d=b}else{d=b['filename'];e=b['worksheet']||'Worksheet'}var f=$('#'+a).prop("outerHTML");$_html=$(f);$_html.find("td[export='no']").remove();$_html.find("th[export='no']").remove();f=$_html.prop("outerHTML");html2xls(f,d,e,c)}function html2xls(b,d,e,f){if(typeof(e)=='undefined')e='sheet1';if(typeof(d)=='undefined')d='data';d=d+'.xls';uri='data:application/vnd.ms-excel;base64,';xlstemplate='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style type="text/css">td{mso-number-format:"@"}</style></head><body>{table}</body></html>';base64=function(s){return window.btoa(unescape(encodeURIComponent(s)))};format=function(s,c){return s.replace(/{(\w+)}/g,function(m,p){return c[p]})};var g={worksheet:e,table:b};var h=format(xlstemplate,g);var i=base64(h);if(window.navigator.msSaveBlob){var j=b64toBlob(i);window.navigator.msSaveBlob(j,d)}else{if(navigator.userAgent.indexOf('MicroMessenger')>-1&&navigator.userAgent.indexOf('WindowsWechat')==-1){var k="/teacher/post2oss?ext=xls";var l={content:h};$.post(k,l,function(a){if(a.error){alert(a.msg)}else{document.location.href="/teacher/exp_result?file="+a.data}},'json')}else{var n=$('<a style="display:none"></a>').appendTo('body');n[0].href=uri+i;n[0].download=d;n[0].click();n.remove()}}}function bjmform_snapshot(a,b){window['bjmform_snapshot_'+a]=$(b).html()}function bjmform_clear(a,b){var c='bjmform_snapshot_'+a;if(!window[c]){bjmform_snapshot(a,b)}$(b).html(window[c]);$('.form-control-datetimepicker').on('click',function(){weuidatetimepicker(this)});bjmform_addr_auto_flag=false}function bjmform_getdata_full(b,c){var d=bjmform_getdata(b,c);$(b).find('[bjmfform_autogps]').each(function(){var a=$(this).attr('name');if(a.length<=c.length||a.substr(0,c.length)!==c){return}a=a.substr(c.length+1,a.length-c.length-2);d[a]=$(this).val()});return d}function bjmform_ele_clear(a){var b=$(a).attr('type');if(typeof(b)!='undefined'&&(b=='radio'||b=='checkbox'))$(a).prop('checked',false);else $(a).val('')}function bjmform_score_calc(){var b=0;$('input[bjmf-score]:visible:checked').each(function(){var a=$(this).attr('bjmf-score');try{a=parseFloat(a);if(!isNaN(a))b+=a}catch(_e){}});$('option[bjmf-score]:selected').each(function(){if($(this).closest('select:visible').length==0)return;var a=$(this).attr('bjmf-score');try{a=parseFloat(a);if(!isNaN(a))b+=a}catch(_e){}});$('#bjmf_score').val(b);return b}function bjmform_ini(i,j,l,m){if(i==undefined||i==null||!i)i=[];if(typeof(m)==undefined){m=0}$.each(i,function(k,v){$("[name='"+j+"["+k+"]'][type!=radio]").val(v);$("[name='"+j+"["+k+"]'][type=radio][value='"+v+"']").prop("checked",true);if(Array.isArray(v)){$.each(v,function(a,b){$("[name='"+j+"["+k+"][]'][value='"+b+"']").prop("checked",true)})}$("[name='"+j+"["+k+"][]'][value='"+v+"']").prop("checked",true)});$.each(i,function(k,v){$("[name='"+j+"["+k+"]'][type=radio][title='"+v+"']").prop("checked",true);$("[name='"+j+"["+k+"]']").find("option[title='"+v+"']").prop("selected",true);if(Array.isArray(v)){$.each(v,function(a,b){$("[name='"+j+"["+k+"][]'][value='"+b+"']").prop("checked",true)})}});var n=function(g){var h=[];$("[link_n="+g+"]").each(function(a,b){if(typeof($(this).attr("type"))!="undefined"){if($(this).attr("type")=='text'){h.push($(this).val().trim())}else{if($(this).prop("checked")){h.push($(this).parent().text().trim())}}}else{h.push($(this).find("option:selected").text().trim())}});$("[linkn="+g+"]").each(function(c,d){var e=JSON.parse($(this).attr("linkv"));var f=false;$.each(e,function(a,b){if(jQuery.inArray(b,h)>-1)f=true});if(f)$(this).show("fast");else{$(this).hide("fast");$(this).find('input').each(function(a,b){bjmform_ele_clear($(this));$(this).change()})}})};$("[link_n]").bind("change",function(){var a=$(this).attr("link_n");n(a)});$("[link_n]").each(function(){n($(this).attr("link_n"))});$("[bjmf-score]").bind("change",function(){var a=$(this).attr("bjmf-score");if(typeof(a)=='undefined'||a==''||a=='0')return;bjmform_score_calc()});if($('[bjmfform_address]').length>0){var o=window.sitecdn===undefined?'//c.d8n.cn':window.sitecdn;loadScript(o+"/res/app_form_address.js",function(){bjmform_addr_auto()})}if(l){$.each(i,function(k,v){$("[name='"+j+"["+k+"]']").prop('disabled',true);$("[name='"+j+"["+k+"][]']").prop('disabled',true);$("[bjmfform_address='"+j+"_"+k+"']").find('select, input').prop('disabled',true);$("[name='"+j+"["+k+"]']:checked").parent().css('color','var(--primary)');$("[name='"+j+"["+k+"][]']:checked").parent().css('color','var(--primary)')});$('.form-group[data-type] [name^="fm["]').prop('disabled',true);$(".form_uploadfile").each(function(){_attach_html=bjmf_attachment_format($(this).val());$(this).after(_attach_html)});$('.form-group[data-type=file] .jFiler-input-dragDrop').hide();$('.form-group[data-type=file] .jFiler-item-trash-action').hide()}else{$(".form_uploadfile").each(function(){fix_attachments_url(this);html_upload_js($(this).attr("id"),get_current_role(),j)});var p=false;$('[dic]').each(function(){if($(this).attr('dic')&&$(this).attr('dic').length>0)p=true});if(p){loadScript('/res/app_form_dic.js',function(){dic_init()})}}}function bjmform_getdata(c,d){_fdata={};_mutiFields=[];c.find('[name]').each(function(){_name=$(this).attr('name');if(_name.length<=d.length||_name.substr(0,d.length)!=d)return;if(_name.indexOf('gps')>-1)return;if($(this).attr('bjmfform_autogps')!=undefined)return;_savename=_name.substr(d.length);_savename=_savename.replace(/\[/ig,'').replace(/\]/ig,'');if(_name.substr(_name.length-2,2)=='[]'){if(_mutiFields.indexOf(_savename)==-1){_mutiFields.push(_savename);_fdata[_savename]=[]}}else{if($(this).attr('type')=='radio'){if(c.find("[name='"+_name+"']:checked").length>0)_fdata[_savename]=c.find("[name='"+_name+"']:checked").val()}else{_nodename=$(this)[0].nodeName;if(_nodename=='SELECT'||_nodename=='INPUT'||_nodename=='TEXTAREA'){_fdata[_savename]=$(this).val()}}}});$.each(_mutiFields,function(a,b){c.find("[type=checkbox][name='"+d+"["+b+"][]']:checked").each(function(){_fdata[b].push($(this).val())})});return _fdata}function mapsel(c){if(in_wxapp()){$('<div style="position: absolute;left: 0;top: 0;width: 100%;height: 100%;background: #fff;z-index:99999;" id="bjmf_selmap_div"><iframe id="mapPage" width="100%" height="100%" frameborder=0 src="/'+gconfig.role+'/plugin/mapsel"></iframe>').appendTo('body');window.bjmf_plugin_selok=function(a,b){$(c).val(a);$('#bjmf_selmap_div').remove()}}else{$('<div style="position: absolute;left: 0;top: 0;width: 100%;height: 100%;background: #fff;z-index:99999;" id="bjmf_selmap_div"><iframe id="mapPage" width="100%" height="100%" frameborder=0 src="https://apis.map.qq.com/tools/locpicker?search=1&type=1&key=E6LBZ-RJJCK-TBAJY-A5XM3-6ZR32-SIFZH&referer=myapp"></iframe>').appendTo('body');setTimeout(function(){$('#bjmf_selmap_div').height($(window).height());$('#bjmf_selmap_div').width($(window).width());window.addEventListener('message',function(a){var b=a.data;if(b&&b.module=='locationPicker'){console.log('location',b);$('#bjmf_selmap_div').hide();_addr=b.poiaddress+'|'+b.latlng.lat.toFixed(5)+','+b.latlng.lng.toFixed(5);$(c).val(_addr);$('#bjmf_selmap_div').remove()}},false)},2000)}}wx_readyed=false;var geo_quick=[{range:[35.3236,35.3321,113.9075,113.9225],addr:'河南省,新乡市,牧野区,河南师范大学'},{range:[22.5847,22.5896,113.9664,113.9763],addr:'广东省,深圳市,南山区,哈尔滨工业大学(深圳)'},{range:[39.542,39.548,117.389,117.403],addr:'天津市,天津市,宝坻区,北京科技大学天津学院'},{range:[35.29468,35.2991,114.06565,114.07241],addr:'河南省,新乡市,红旗区,新联学院'},{range:[21.160,21.169,110.237,110.252],addr:'广东省,湛江市,麻章区,广东海洋大学寸金学院(新湖校区)'},{range:[36.17,36.1744,120.434,120.440],addr:'山东省,青岛市,李沧区,巨峰路山东外贸职业学院'},{range:[23.141,23.1453,113.3144,113.324],addr:'广东省,广州市,天河区,广州体育学院'},{range:[24.073,24.079,117.531,117.541],addr:'福建省,漳州市,漳浦县,漳州科技学院'},{range:[23.366,23.3705,113.4255,113.431],addr:'广东省,广州市,白云区,广东行政职业学院（白云校区）'},{range:[27.806,27.812,114.886,114.897],addr:'江西省,新余市,渝水区,江西工程学院（天工校区）'},{range:[25.667,25.673,100.292,100.298],addr:'云南省,大理白族自治州,大理市,滇西应用技术大学'},{range:[27.772,27.779,114.841,114.852],addr:'江西省,新余市,渝水区,江西工程学院科技园'},{range:[23.3983,23.4022,113.1848,113.1885],addr:'广东省,广州市,花都区,广东行政职业学院'},{range:[25.8473,25.8514,114.93,114.9323],addr:'江西省,赣州市,章贡区,章贡区赣南师范大学科技学院'},{range:[28.8108,28.8147,111.939,111.944],addr:'湖南省,常德市,汉寿县,湖南高尔夫旅游职业学院'},{range:[30.7463,30.7509,108.4408,108.4565],addr:'重庆市,重庆市,万州区,重庆三峡学院(百安校区)'},{range:[30.7463,30.7563,108.4492,108.4565],addr:'重庆市,重庆市,万州区,重庆三峡学院(百安校区)'},{range:[31.6231,31.63033,118.8976,118.9078],addr:'江苏省,南京市,溧水区,江苏第二师范学院(石湫校区)'},{range:[36.074,36.0757,120.38295,120.385],addr:'山东省,青岛市,市南区,山东外贸职业学院(南校区)'},{range:[38.3815,38.3895,117.3089,117.320],addr:'河北省,沧州市,黄骅市,沧州交通学院'},{range:[34.1326,34.1353,113.8275,113.8297],addr:'河南省,许昌市,建安区,许昌陶瓷职业学院'},{range:[23.1054,23.0983,113.4773,113.4807],addr:'广东省,广州市,黄埔区,广州航海学院红山三路校区'},{range:[44.0711,44.0746,125.1816,125.1754],addr:'吉林省,长春市,宽城区,吉林司法警官职业学院'}];function gps_in_range(a,b,c){if(a>=c[0]&&a<=c[1]&&b>=c[2]&&b<=c[3]){return true}return false}function gps_in_ranges(c,d,e){var f=false;$.each(e,function(a,b){if(gps_in_range(c,d,b))f=true});return f}function gps_in_ranges_compatible(a,b){if(!a||!b){return null}var c,lng;if(typeof(a)==='string'){a=a.split(',')}if($.isArray(a)){c=a[0];lng=a[1]}else if($.isPlainObject(a)){c=a.lat||a.latitude;lng=a.lng||a.longitude}if(!c||!lng){return null}c=parseFloat(c);lng=parseFloat(lng);var d=false;if($.isArray(b)){if(gps_in_ranges(c,lng,b)){d=true}}else{if(b.lat===null||b.lng===null||b.radius===null){return null}var e=geoDistance(c,lng,b.lat,b.lng);if(e<=b.radius){d=true}}return d}function bjmf_geo_code_parse(a){var b='';var c='';var d='';if(typeof(a['type'])!='undefined'&&a['type']=='quick'){b=a['addr'];c=parseFloat(a['lat']).toFixed(5);d=parseFloat(a['lng']).toFixed(5)}else if(typeof(a['type'])!='undefined'&&a['type']=='local'){b=a['addr'];c=parseFloat(a['lat']).toFixed(5);d=parseFloat(a['lng']).toFixed(5)}else{c=a.result.location.lat.toFixed(5);d=a.result.location.lng.toFixed(5);var e=a.result.address_component;b=e.province+','+e.city+','+e.district+','+e.street+e.street_number.replace(e.street,'');if(typeof(a.result['formatted_addresses'])!='undefined'&&typeof(a.result['formatted_addresses']['recommend'])!='undefined')b+=a.result['formatted_addresses']['recommend']}return{lat:c,lng:d,addr:b,addr4bjmf:(b+'|'+c+','+d)}}function autogps(b,c){if(typeof(b)=='undefined')b='[bjmfform_autogps]';if(typeof(c)=='undefined')c=true;if(navigator.userAgent.indexOf('MicroMessenger')>-1){if(wx_readyed)return autogps_cb(b,c);if(typeof(wx_js_sign_data)!='undefined'&&typeof(wx_js_sign_data['nonceStr'])!='undefined'){if(typeof(wx_js_signed_by_myself)!='undefined'&&wx_js_signed_by_myself)return;wx.ready(function(){wx_readyed=true;autogps_cb(b,c)});wx.config(wx_js_sign_data);return}loadScript("//res.wx.qq.com/open/js/jweixin-1.6.0.js",function(){$.get('/weixin/jsticket?url='+encodeURIComponent(document.location.href),function(a){wx.ready(function(){wx_readyed=true;autogps_cb(b,c)});wx.config({debug:false,appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:['checkJsApi','openLocation','getLocation','getNetworkType']})},'json')})}else{alert('无法自动获取位置，建议在微信中打开以自动获取位置')}}function loadWeChat(b){if(navigator.userAgent.indexOf('MicroMessenger')>-1){if(wx_readyed){return}loadScript("//res.wx.qq.com/open/js/jweixin-1.6.0.js",function(){$.get('/weixin/jsticket?url='+encodeURIComponent(document.location.href),function(a){wx.ready(function(){wx_readyed=true});wx.config({debug:false,appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:['checkJsApi','openLocation','getLocation','getNetworkType']})},'json')})}else if(b){alert('建议在微信中打开该页面。')}}function localgeo(f){var g='geos';if(window.localStorage){var h=[];var i=window.localStorage.getItem(g);if(i){try{h=JSON.parse(i)}catch(e){console.log('localStorageJSON error')}}var j=false;$.each(h,function(a,b){var c=Math.abs(parseFloat(b.lat)-parseFloat(f.lat));var d=Math.abs(parseFloat(b.lng)-parseFloat(f.lng));if(c<=0.0001&&d<=0.0001){j=b}});if(typeof(f['addr'])=='undefined'){if(j!==false){f['addr']=j.addr;return f}else return null}else{if(j===false){h.push(f);window.localStorage.setItem(g,JSON.stringify(h))}return f}}return null}function bjmf_geo_code_cb(a){if(typeof(bjmf_geo_code)=='undefined'){console.log('未定义bjmf_geo_code',a)}else{var b=bjmf_geo_code_parse(a);localgeo(b);bjmf_geo_code(a)}}function autogps_cb(h,i){if(typeof(h)=='undefined')h='[bjmfform_autogps]';if(typeof(i)=='undefined')i=true;networkType='nothing';wx.getNetworkType({success:function(a){networkType=a.networkType}});ret=wx.getLocation({type:'gcj02',success:function(c){if(typeof(bjmf_geo_code)=='undefined'){window.bjmf_geo_code=function(a){var b=bjmf_geo_code_parse(a);if(typeof(h)=='undefined')h='[bjmfform_autogps]';if($(h).length>0)$(h).val(b.addr4bjmf)}}if(!i){return bjmf_geo_code({type:'quick',addr:'',lat:c.latitude,lng:c.longitude})}if($(h).length>0){$(h).val('|'+parseFloat(c.latitude).toFixed(5)+','+parseFloat(c.longitude).toFixed(5));$('.autogps_btn_area').html('已成功获取位置')}var d=localgeo({type:'quick',lat:c.latitude,lng:c.longitude});if(d!==null){bjmf_geo_code(d);return}var e=false;$.each(geo_quick,function(a,b){if(e)return;if(gps_in_range(c.latitude,c.longitude,b.range)){e=true;bjmf_geo_code({type:'quick',addr:b.addr,lat:c.latitude,lng:c.longitude})}});if(e)return;var f="https://apis.map.qq.com/ws/geocoder/v1";var g={location:c.latitude+","+c.longitude,key:'E6LBZ-RJJCK-TBAJY-A5XM3-6ZR32-SIFZH',get_poi:0,output:"jsonp"};$.ajax({type:"get",url:f,data:g,dataType:'jsonp',jsonpCallback:"bjmf_geo_code_cb",success:function(a){bjmf_geo_code_cb(a)},error:function(a){console.log(a)}})},fail:function(a){if(networkType!='wifi')alert("获取位置失败（"+JSON.stringify(a)+"），可打开WIFI和定位后再尝试");else alert("获取位置失败（"+JSON.stringify(a)+"），可进行以下操作后再尝试：打开手机定位和授权微信定位权限")},complete:function(a){console.log('complete')},cancel:function(a){console.log('cancel');alert("已取消，如果需要获取，还可以点上方“自动获取位置”按钮重试")}})}function bjmform_checkform(){_needfilla=[];$("[bmfe]:visible").each(function(){_t=$(this);_required=!(typeof(_t.attr('bmneed'))=='undefined');if(!_required)return;_v='';if(typeof(_t.attr('type'))!='undefined'&&(_t.attr('type')=='radio'||_t.attr('type')=='checkbox')){if($("[name='"+_t.attr('name')+"']:checked").length>0)_v=$("[name='"+_t.attr('name')+"']:checked").val()}else{_v=_t.val()}_fillvalue=_t.attr('name');if(_v.trim().length<1){if(jQuery.inArray(_fillvalue,_needfilla)==-1)_needfilla.push(_fillvalue)}});if(_needfilla.length>0){alert('还有'+_needfilla.length+'项必填项没有填写，填写后再提交');return false}bjmform_score_calc();$('[type=file]').remove();return true}function bjmf_rdochk_ini(){bjmf_rdochecked(".bjmfrdochk");$(".rdobox").unbind("click",bjmf_rdochecked_rdo).bind("click",bjmf_rdochecked_rdo);$(".chkbox").unbind("click",bjmf_rdochecked_chk).bind("click",bjmf_rdochecked_chk)}function bjmf_rdochecked_rdo(){$(this).prev().prop("checked","checked");bjmf_rdochecked(".bjmfrdochk")}function bjmf_rdochecked_chk(){if($(this).prev().prop("checked")==true){$(this).prev().removeAttr("checked")}else{$(this).prev().prop("checked","checked")}bjmf_rdochecked(".bjmfrdochk");if(typeof(cb_bjmf_rdochecked_chged)!='undefined')cb_bjmf_rdochecked_chged($(this).prev())}function bjmf_rdochecked(b){$(b).each(function(i){var a=$(b).eq(i).next();if($(b).eq(i).prop("checked")==false){a.removeClass("checked");a.addClass("unchecked");a.find(".check-image").css("background","url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAbUExURQAAALW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tW01flwAAAAIdFJOUwDtBpHukImILT7eIAAAACdJREFUCNdjYCANMBk6K4AZrB0dBWAGY0eHACoDKJUAUWwCVUw8AADNiwZs9OOD8wAAAABJRU5ErkJggg==)")}else{a.removeClass("unchecked");a.addClass("checked");a.find(".check-image").css("background","url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABmUExURQAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5WfaagAAAAhdFJOUwCenbkBCpUCA6ShB5+qkLSbkqu9mqIEpoqEiMCWCZy4mI+19xIAAABoSURBVCjPpY83FsMwFMPgIn/J6b0X3P+SWZJnZ8gUblhAEv5LPB/pi+/ajLlWq4H3M7VruZUzALlX+wwXPQJ5p04DuKonclGrAIiiztdqHW/5QVVX7Uc/aVSXMRSmjW5jPDEtuvbnnxeJXQfKWoecZgAAAABJRU5ErkJggg==)")}})}function fix_attachments_url(a){if(!a.value||a.value.startsWith('[{')){return}var b=a.value.split(',');if(b.length===1&&!b[0]){return}var c=[];$.each(b,function(i,v){c.push({name:'附件 '+(i+1),file:v,size:1,type:''})});a.value=JSON.stringify(c)}function wxtask_noticeadd_cb(a){if(typeof(a.s)=='undefined')return'请求返回异常';if(a.s=='ok')return'已开始提醒';if(a.s=='repeat')return'已提醒过，一个事件的全员提醒，一天只能提醒一次';return''}function wxtask_notice(b,c,d,e,f){_postdata={flag:c,url:d,title:e};if(dealUndefined(f)=='')_postdata['courseids']=b;else _postdata['groupids']=f;$.post('/teacher/course/'+b+'/wxtasknotice',_postdata,function(a){alert(wxtask_noticeadd_cb(a))},'json')}function pick_event_ask2add(b){bjmf_prompt(b['title'],function(a){pick_event_add(b['course_id'],b['flag'],b['studentids'],a,b['remark'])},b['defaultv'])}function pick_event_add(b,c,d,e,f){var g={flag:c,studentids:d,v:e,name:f};var h='/teacher/picks/course/'+b+'/quick';if(gconfig&&gconfig.role&&gconfig.role=='org'){h='/org/picks/quick';g['course_id']=b}$.post(h,g,function(a){if(typeof(a.s)=='undefined')alert('请求返回异常，可尝试重试');if(a.s=='ok')alert('已完成批量记分');if(a.s=='repeat')alert('当前事件已记分过一遍啦')},'json')}function dealUndefined(a){if(typeof(a)=='undefined'){console.log('something undefined');return''}else return a}function renderPagination(){var d=window.__pagination__;if(!d){return}if(window.layui){layui.use(['laypage'],function(){var c=layui.laypage;c.render({elem:'pagination',limit:d.limit,curr:d.page,count:d.total,jump:function(a,b){if(!b){location.href='?limit='+a.limit+'&page='+a.curr}}})})}else{var e=$('#pagination');e.html('<ul class="pagination justify-content-center my-3">\n'+'    <li class="page-item first disabled">\n'+'      <a class="page-link" href="#">首页</a>\n'+'    </li>\n'+'    <li class="page-item prev disabled"><a class="page-link" href="#">上一页</a></li>\n'+'    <li class="page-item current"><a class="page-link" href="#">1</a></li>\n'+'    <li class="page-item next disabled"><a class="page-link" href="#">下一页</a></li>\n'+'    <li class="page-item last disabled">\n'+'      <a class="page-link" href="#">末页</a>\n'+'    </li>\n'+'  </ul>');var f='?limit='+d.limit+'&page=';var g=e.find('.page-item');g.filter('.current').find('a').text(d.page).attr('href',f+d.page);if(d.page>1){g.filter('.prev').removeClass('disabled').find('a').attr('href',f+(d.page-1));g.filter('.first').removeClass('disabled').find('a').attr('href',f+1)}if(d.page*d.limit<d.total){g.filter('.next').removeClass('disabled').find('a').attr('href',f+(d.page+1));g.filter('.last').removeClass('disabled').find('a').attr('href',f+Math.ceil(d.total/d.limit))}}}function auto_bjmfHelp(){$('[bjmf-help]').click(function(){var a=$(this);a.css('cursor','pointer');var b='alert';if(a.attr('help-type'))b=a.attr('help-type');if(b=='iframe')bjmf_iframe(a.attr('help-url'),a.attr('help-title'));else{var c=a.attr('help-content');if(!c)c=$(a.attr('bjmf-help')).html();bjmf_alert(c,a.attr('help-title'))}})}function getLayer(a){if(typeof(layer)=='object'){a(layer)}else{var b=(typeof(sitecdn)=='undefined')?'//c.d8n.cn':window.sitecdn;loadScript(b+"/layer/layer.js",function(){a(layer)})}}function bjmf_msg(b){getLayer(function(a){a.msg(b)})}function bjmf_tips(b,c){getLayer(function(a){a.tips(b,c)})}function bjmf_alert(b){getLayer(function(a){a.alert(b)})}function bjmf_confirm(b,c,d){getLayer(function(a){a.confirm(b,{},c,d)})}function bjmf_iframe(b,c,d){getLayer(function(a){a.open({type:2,title:c,area:[(($(window).width()*0.9)+'px'),(($(window).height()*0.9)+'px')],content:b,end:function(){if(typeof(d)!='undefined')d()}})})}function bjmf_prompt(e,f,g){getLayer(function(d){d.prompt({value:(g?g:''),title:e,},function(a,b,c){f(a);d.close(b)})})}$(function(){auto_bjmfHelp();autoLinkTextNodes();bjmf_rdochk_ini();renderPagination();$('.form-control-datetimepicker').on('click',function(){weuidatetimepicker(this)});$('.form-control-timepicker').on('click',function(){weuitimepicker(this)});addRedDots();$('.text2html').each(function(){var a=$(this);a.html(text2html(a.text()))})});function bjmf_attachment_format(c,d){if(typeof(c)=='string'&&c.substr(0,1)=='['&&c.substr(c.length-1,1)==']'&&c.indexOf('"file"')>-1&&c.indexOf('"name"')>-1){_aahtml='';_aa=JSON.parse(c);$.each(_aa,function(a,b){if(typeof(d)=='undefined')_aahtml+='<a target="_blank" href="'+b.file+'">附件'+(a+1)+'</a> ';else _aahtml+='<a href="javascript:void(0);" onclick="'+d+'(\''+b.file+'\')">附件'+(a+1)+'</a> '});return _aahtml}return c}function easyui_attachment_format(a,b,c){return bjmf_attachment_format(a,undefined)}function cutString(a,b){if(a.length*2<=b){return a}var c=0;var s="";for(var i=0;i<a.length;i++){s=s+a.charAt(i);if(a.charCodeAt(i)>128){c=c+2;if(c>=b){return s.substring(0,s.length-1)+"..."}}else{c=c+1;if(c>=b){return s.substring(0,s.length-2)+"..."}}}return s}function bjmf_cmdbar(c,d){$('<style>.bjmf-cmdbar{font-size:14px;color:#555}.bjmf-cmdbar-items{clear:both;margin:0;padding:0}.bjmf-cmdbar-item{padding:0 4px;margin:0;border:0;cursor:pointer;display:inline-block}.bjmf-cmdbar-item i{padding:0 4px;color:#0078d4;height:22px;line-height:22px}.bjmf-cmdbar-item span{padding:0}.bjmf-cmdbar-showarea{overflow:hidden}.bjmf-cmdbar-showarea li{float:left}.bjmf-cmdbar-morearea{position:relative;text-align:right;display:none}</style>').appendTo('body');_bjmf_cmdbar_html='<div class="bjmf-cmdbar"><ul class="bjmf-cmdbar-items bjmf-cmdbar-showarea"></ul><ul class="bjmf-cmdbar-items bjmf-cmdbar-morearea"></ul></div>';$(c).html(_bjmf_cmdbar_html);$.each(d,function(a,b){_tmpstyle='';if(typeof b.style!='undefined')_tmpstyle=b.style;_bjmfcmdbar_tmp_html='<li class="bjmf-cmdbar-item" style="'+_tmpstyle+'"><i class="'+b.icon+'"></i><span>'+b.title+'</span></li>';$(_bjmfcmdbar_tmp_html).bind('click',b.click).appendTo('.bjmf-cmdbar-showarea')});_morebtnhtml='<li class="bjmf-cmdbar-item" onclick="$(\'.bjmf-cmdbar-morearea\').toggle();"><i class="las la-ellipsis-h"></i></li>';_morebtnlen=30;_maxlen=$('.bjmf-cmdbar').width()-_morebtnlen;_curlen=0;_willAddToMore=false;_allea=$('.bjmf-cmdbar-showarea').find('.bjmf-cmdbar-item');_allealen=_allea.length;_lastlen=_maxlen;_allea.each(function(a,b){if(_willAddToMore){$(this).clone(true).appendTo('.bjmf-cmdbar-morearea');$(this).remove();return}_thisitemlen=$(this).outerWidth();if(_curlen+_thisitemlen>_maxlen){$(_morebtnhtml).appendTo('.bjmf-cmdbar-showarea');_willAddToMore=true;$(this).clone(true).appendTo('.bjmf-cmdbar-morearea');$(this).remove();return}_curlen+=_thisitemlen;_lastlen=_maxlen-_curlen})}function href(a){document.location.href=a}function geoDistance(c,d,e,f){let radLat1=rad(c);let radLat2=rad(e);let a=radLat1-radLat2;let b=rad(d)-rad(f);let s=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(radLat1)*Math.cos(radLat2)*Math.pow(Math.sin(b/2),2)));s=s*6378137;s=Math.round(s);return s}function rad(d){return d*Math.PI/180.0}function geoDistance2Ranges(a,b,c){if(c.length==0)return-1;var d=10000000;for(var e=0;e<c.length;e++){var f=c[e];var g=geoDistance(a,b,f[0],f[1]);var h=g-f[2];d=Math.min(d,h);if(h<=50)return-1}return d}function bjmf_timestamp2str(b){var c=(b+'').split('');for(var d=0;d<13;d++){if(!c[d]){c[d]='0'}}b=c.join('')*1;var e=1000*60;var f=e*60;var g=f*24;var h=g*15;var i=g*30;var j=new Date().getTime();var k=j-b;if(k<0){return'不久前'}var l=k/i;var m=k/(7*g);var n=k/g;var o=k/f;var p=k/e;var q=function(a){if(a<10){return'0'+a}return a};if(l>12){return(function(){var a=new Date(b);return a.getFullYear()+'年'+q(a.getMonth()+1)+'月'+q(a.getDate())+'日'})()}else if(l>=1){return parseInt(l)+"月前"}else if(m>=1){return parseInt(m)+"周前"}else if(n>=1){return parseInt(n)+"天前"}else if(o>=1){return parseInt(o)+"小时前"}else if(p>=1){return parseInt(p)+"分钟前"}return'刚刚'}function bjmf_form_filldata(a,b){a.find("input,select,textarea").each(function(){_ele_e=$(this);if(!_ele_e.is('[name]'))return;_ele_name=_ele_e.attr('name').trim();_is_array=false;if(_ele_name.substr(_ele_name.length-2)=='[]'){_v_k=_ele_name.substr(0,_ele_name.length-2)}else{_v_k=_ele_name}_v_k="___formdata."+_v_k.replace(/]/g,'').replace(/\[/g,'.');try{___v=eval(_v_k)}catch(e){return}if(typeof(___v)=='undefined')return;if(_ele_e.is('input')&&_ele_e.attr('type')=='checkbox'){if(___v.indexOf(_ele_e.val())>-1)_ele_e.prop('checked',true)}else if(_ele_e.is('select')&&_ele_e.is('[multiple]')){_ele_e.find('option').each(function(){if(___v.indexOf($(this).attr('value'))>-1)$(this).prop('selected',true)})}else if(_ele_e.is('input')&&_ele_e.attr('type')=='radio'){if(_ele_e.val()==___v)_ele_e.prop('checked',true)}else{_ele_e.val(___v)}})}function urladd(a,b){if(typeof(b)=='undefined'||b==''||b==false)b=document.location.href;for(_urlk in a){b=changeQueryString(_urlk,a[_urlk],b)}return b}function urlallflow(d,e){if(typeof(e)=='undefined'||e==''||e==false)e=document.location.href;$('a[href]').each(function(){var a=$(this);var b=a.attr('href');if(b.sub(0,1)=='#'||b.sub(0,11)=='javascript:'||b.sub(0,4)=='tel:')return;var c=urlflow(b,e,d);a.attr('href',c)})}function urlflow(a,b,c){if(typeof(b)=='undefined'||b==''||b==false)b=document.location.href;if(b.indexOf('?')==-1)return a;if(typeof(c)=='undefined'||c===null)c=false;var d=b.substr(b.indexOf('?')+1);var e=d.split('&');for(_qs_i in e){var f=e[_qs_i];if(f.indexOf('=')==-1)continue;var g=f.split('=');if(c!==false&&c.indexOf(g[0])==-1)continue;a=changeQueryString(g[0],g[1],a,true)}return a}function changeQueryString(a,b,c,d){if(typeof(b)=='undefined'||b===null)return c;if(typeof(d)=='undefined'||d===null)d=false;if(c.indexOf('?')==-1)return c+"?"+a+"="+b;var e=c.substr(c.indexOf('?')+1);var f=false;var g=e.split('&');for(_qs_i in g){var h=g[_qs_i];if(h.indexOf('=')==-1)continue;var i=h.split('=');if(i[0]==a){f=true;if(d){}else{if(b===false)g.splice(_qs_i,1);else{g[_qs_i]=a+'='+b}}}}if(!f){g.push(a+'='+b)}return c.substr(0,c.indexOf('?'))+"?"+g.join('&')}var data_bjmf_course_getdata_data={};function bjmf_course_getdata(b,c,d){var f=parseInt((new Date()).valueOf()/1000);var g='cd_'+b+'_'+c;if(typeof(data_bjmf_course_getdata_data[g])!='undefined')return d(data_bjmf_course_getdata_data[g]);if(typeof(urlRoot)=='undefined')urlRoot='/'+document.location.pathname.split('/')[1];var h=urlRoot+'/data/course/'+(b||0)+'/'+c;if(window.localStorage){var i=false;var j=window.localStorage.getItem(g);var k=window.localStorage.getItem(g+'_lask');if(j){try{i=JSON.parse(j)}catch(e){console.log('localStorageJSON error')}}if(i){var l=i.v;var m=i.data;if(f-l<180){console.log(g,'3分钟内新数据，不再问');if(typeof(bjmf_filter_coursedata)!='undefined')m=bjmf_filter_coursedata(c,m);data_bjmf_course_getdata_data[g]=m;return d(m)}if(f-k<180){console.log(g,'3分钟内问询过，不再问');if(typeof(bjmf_filter_coursedata)!='undefined')m=bjmf_filter_coursedata(c,m);data_bjmf_course_getdata_data[g]=m;return d(m)}$.ajax({url:h+'?v='+l,ldatakey:g,vnow:f,ltruedata:m,success:function(a){window.localStorage.setItem(this.ldatakey+'_lask',this.vnow);if(typeof(a.noc)!='undefined'&&a.noc==1){if(typeof(bjmf_filter_coursedata)!='undefined')m=bjmf_filter_coursedata(c,this.ltruedata);data_bjmf_course_getdata_data[this.ldatakey]=this.ltruedata;d(this.ltruedata)}else{window.localStorage.setItem(this.ldatakey,JSON.stringify(a));if(typeof(bjmf_filter_coursedata)!='undefined')m=bjmf_filter_coursedata(c,a.data);data_bjmf_course_getdata_data[this.ldatakey]=m;d(m)}},dataType:'json'})}else{$.ajax({url:h+'?f=1&v='+f,ldatakey:g,success:function(a){window.localStorage.setItem(this.ldatakey,JSON.stringify(a));if(typeof(bjmf_filter_coursedata)!='undefined')m=bjmf_filter_coursedata(c,a.data);data_bjmf_course_getdata_data[this.ldatakey]=m;d(m)},dataType:'json'})}}}function hideLayUiMenuInIframe(){if(window.parent&&window.parent!==window){$('#leftmenuarea').remove();$('#LAY_app_body').css({left:0});$(function(){var a=$('#headmenuarea');a.find('> .layui-layout-right').remove();a.find('> .layui-layout-left').css({left:0}).find('> li:not(:first)').remove()})}}function navpod(b,c,d){bjmf_course_getdata(b,'navpod',function(a){_np_html='';for(_np_item_key in a){_item=a[_np_item_key];_np_html+=navpod_item2html(_item,b,c)}$('#navpod').html(_np_html);if(typeof(d)=='function')d(a)})}function navpod_item2html(a,b,c){if(typeof(a['id'])=='undefined'||typeof(a['name'])=='undefined')return'';if(typeof(a['url'])!='undefined'){if(typeof(a['url'])=='string')_url=a['url'];else _url=a['url'][role]}else _url=menucode2url(a['id'],b,c);_url=_url.replace('{ROLE}',c).replace('{COURSEID}',b);_url=_url.replace('/ROLE/','/'+c+'/').replace('/COURSEID/','/'+b+'/');return tpl2html($('#tpl_navpod_item').html(),{url:_url,item:a})}function menucode2url(a,b,c){_url='';_ca=a.split('@');_modulecode=_ca[0];if(_modulecode=='profile'){if(_ca.length>1){if(_ca[1].indexOf(',')>-1)_url=_url='/{ROLE}/course/{COURSEID}/profiles?ids='+_ca[1];else _url='/{ROLE}/course/{COURSEID}/profile/'+_ca[1]}else{_url='/{ROLE}/course/{COURSEID}/profiles'}}if(_modulecode=='activity'){if(_ca.length>1){if(_ca[1].indexOf(',')>-1)_url=_url='/{ROLE}/course/{COURSEID}/activitys?ids='+_ca[1];else _url='/{ROLE}/course/{COURSEID}/activitys/show?id='+_ca[1]}else{_url='/{ROLE}/course/{COURSEID}/activitys'}}return _url}function installOptionalBox(){$('.optional-box-ctrl').each(function(){var a=$(this);var b=a.find('.la');var c=a.siblings('.optional-box');a.on('click',function(){if(b.hasClass('la-angle-double-down')){b.removeClass('la-angle-double-down').addClass('la-angle-double-up');c.removeClass('hide')}else{b.removeClass('la-angle-double-up').addClass('la-angle-double-down');c.addClass('hide')}})})}$(function(){installOptionalBox()});function openLocation(b){if(!b){return alert('地址为空！')}if(!b.split){return alert('无效地址：'+b)}var c=b.split(',');if(!c||!c[0]||!c[1]){return alert('无效地址：'+b)}if(!window.wx||!window.wx.openLocation){return openMap(b)}try{wx.openLocation({latitude:Number(c[0]),longitude:Number(c[1]),scale:22,fail:function(a){if(a&&a.errMsg==='openLocation:fail'){openMap(b)}else{alert('打开地图失败！'+(a?a.errMsg:null)||'未知错误')}}.bind(this)})}catch(e){alert('打开地图失败：'+e.message)}}function openMap(a){window.open('http://api.map.baidu.com/geocoder?location='+a+'&coord_type=gcj02&output=html&src=com.banjimofang')}function clearlocal(a){if(typeof(a)=='undefined'){if(confirm('确认清理本地缓存?  系统可能会将一些班级学生列表保存到本地缓存，如果本地网络异常导致没有及时更新，可能会导致新加入学生不显示姓名等问题出现。可在此手动清理以加载最新数据。')){localStorage.clear();alert('清理完成')}}else localStorage.clear()}function in_weixin(){return navigator.userAgent.indexOf('MicroMessenger')>-1}function in_wxapp(){return navigator.userAgent.indexOf('miniProgram')>-1}var loaded_app_js=true;try{if(window.parent!==window&&window.parent.location.href.indexOf('/org')>=0){$('html').addClass('embed-in-org');$(function(){hideLayUiMenuInIframe()})}}catch(e){console.log(e)};function bjmf_title(){var e=document.title,t=$("header.fixed-header > .center");return t?(t.text()||e).trim():e}